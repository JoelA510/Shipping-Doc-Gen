# UI Implementation Gameplan: FormWaypoint Feature Rollout

**Target Agents:** Gemini 3 Pro (High Reasoning), Claude 3.5 Sonnet (Thinking)
**Context:** The backend migration ("Operation Legacy Zero") is complete. All domain logic resides in `apps/api/src/modules`. The frontend (`apps/web`) is scaffolded but lacks domain features.

---

## 1. Architectural Standards (Strict Adherence)

### Technology Stack

- **Framework:** React 19 + Vite
- **Routing:** TanStack Router (File-based: `src/routes`)
- **Data Fetching:** TanStack Query v5 (via Hono RPC)
- **Styling:** Tailwind CSS v4 (No custom CSS files unless correctly layering)
- **Components:** Shadcn/UI (Radix Primitives)

### Feature-Based Folder Structure

Do **NOT** group by type (components, hooks). Group by **Domain Feature**.

```
apps/web/src/features/
├── auth/           # Login, Register, ProtectedRoute
├── freight/        # Carrier list, Rate shopping
├── parties/        # Address book, Party forms
├── products/       # Product catalog, HTS lookup
├── compliance/     # Screening results, AES dashboard
└── templates/      # Shipment presets, Doc generation
```

### Data Access Pattern (Hono RPC)

Use the pre-configured client in `src/utils/client.ts`.

```typescript
// queryOptions pattern for TanStack Query
const shippingOptions = queryOptions({
  queryKey: ['shipments'],
  queryFn: async () => {
    const res = await client.shipments.$get()
    if (!res.ok) throw new Error('Failed')
    return res.json()
  }
})
```

---

## 2. Implementation Sequence

### Phase 1: Core Foundation (The Enablers)

**Goal:** strict auth and layout shell.

1. **Auth Feature (`features/auth`)**
    - Implement `LoginForm.tsx` & `RegisterForm.tsx`.
    - Hook up to `client.auth.login.$post`.
    - Create `AuthProvider` context (Zustand store for token/user).
    - Create `ProtectedRoute` component for TanStack Router.
2. **App Shell (`routes/__root.tsx`)**
    - Implement Sidebar Navigation (Dashboard, Shipments, Parties, Products, etc.).
    - Add UserDropdown (Logout).

### Phase 2: Master Data Management

**Goal:** Enable users to set up their data.

1. **Parties (`features/parties`)**
    - **List**: `Route /parties`. DataGrid of saved parties.
    - **Create/Edit**: Modal form. Reusable `AddressForm` component.
2. **Products (`features/products`)**
    - **List**: `Route /products`.
    - **Feature**: "Smart Classify" button calling `client.classification.predict.$post`.

### Phase 3: The Shipping Flow (The Core)

**Goal:** The main business value.

1. **Shipment List**
    - Filters (Status, Date, Origin/Dest).
2. **Shipment Editor (Wizard)**
    - **Step 1**: Parties (Select from Address Book or Create).
    - **Step 2**: Line Items (Select from Product Catalog).
    - **Step 3**: Freight (Shop Rates via `client.freight.rates.shop.$post`).
    - **Step 4**: Compliance (Async check via `client.compliance.screen.$post`).
    - **Step 5**: Review & Book.

### Phase 4: Operations & Reporting

1. **Document Center (`features/templates`)**
    - Template Manager UI.
    - "Generate Docs" Action in Shipment Review.
2. **Reporting Dashboard (`features/reporting`)**
    - Charts: Shipments over time, Spend by Carrier.
    - Use `Recharts` or similar.

---

## 3. Best Practices for the Agent

- **Vertical Slices**: When working on "Parties", do not touch "Freight". Finish one complete feature before moving.
- **Type Safety**: Never use `any`. If type inference fails, check `apps/api` export.
- **Optimistic Updates**: Use TanStack Query `onMutate` for instant feedback on simpler CRUD actions.
- **Error Handling**: Wrap route components in `ErrorComponent` (TanStack Router).

## 4. Immediate Next Task

Start with **Phase 1: Auth Feature**.

1. Verify `apps/api` is running (`pnpm --filter api dev`).
2. Create `apps/web/src/features/auth/login-form.tsx`.
3. Wire it up to `/auth/login`.

---

*Generated by Antigravity Agent (Gemini 3 High) on 2026-01-22*
