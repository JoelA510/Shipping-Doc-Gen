
> test
> npm run test --workspaces apps/api/tests/tenancy.test.js


> @formwaypoint/api@0.1.0 test
> jest apps/api/tests/tenancy.test.js

FAIL tests/tenancy.test.js
  Multi-tenant Isolation
    Parties (Address Book)
      â”œÃ¹ GET /parties should filter by createdByUserId (30 ms)
    Items
      â”œÃ¹ GET /items should filter by createdByUserId (5 ms)
    Carriers (Rate Shopping)
      â”œÃ¹ POST /shipments/:id/rates should only use User A carrier accounts (5 ms)

  Î“Ã¹Ã… Multi-tenant Isolation Î“Ã‡â•‘ Parties (Address Book) Î“Ã‡â•‘ GET /parties should filter by createdByUserId

    expect(received).toHaveProperty(path, value)

    Expected path: "createdByUserId"
    Received path: []

    Expected value: "user-a-id"
    Received value: {"isAddressBookEntry": true}

      113 |
      114 |             const callArgs = mockPrisma.party.findMany.mock.calls[0][0];
    > 115 |             expect(callArgs.where).toHaveProperty('createdByUserId', userA);
          |                                    ^
      116 |         });
      117 |     });
      118 |

      at Object.toHaveProperty (tests/tenancy.test.js:115:36)

  Î“Ã¹Ã… Multi-tenant Isolation Î“Ã‡â•‘ Items Î“Ã‡â•‘ GET /items should filter by createdByUserId

    expect(received).toHaveProperty(path, value)

    Expected path: "createdByUserId"
    Received path: []

    Expected value: "user-a-id"
    Received value: {}

      128 |
      129 |             const callArgs = mockPrisma.item.findMany.mock.calls[0][0];
    > 130 |             expect(callArgs.where).toHaveProperty('createdByUserId', userA);
          |                                    ^
      131 |         });
      132 |     });
      133 |

      at Object.toHaveProperty (tests/tenancy.test.js:130:36)

  Î“Ã¹Ã… Multi-tenant Isolation Î“Ã‡â•‘ Carriers (Rate Shopping) Î“Ã‡â•‘ POST /shipments/:id/rates should only use User A carrier accounts

    expected 200 "OK", got 404 "Not Found"

      152 |                 .post(`/shipments/${shipmentId}/rates`)
      153 |                 .set('Authorization', `Bearer ${tokenA}`)
    > 154 |                 .expect(200);
          |                  ^
      155 |
      156 |             const callArgs = mockPrisma.carrierAccount.findMany.mock.calls[0][0];
      157 |             expect(callArgs.where).toHaveProperty('userId', userA);

      at Object.expect (tests/tenancy.test.js:154:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 3 total
Snapshots:   0 total
Time:        2.356 s, estimated 3 s
Ran all test suites matching /apps\\api\\tests\\tenancy.test.js/i.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\joel.abraham\Shipping Doc Gen\Shipping-Doc-Gen\apps\api
npm error workspace @formwaypoint/api@0.1.0
npm error location C:\Users\joel.abraham\Shipping Doc Gen\Shipping-Doc-Gen\apps\api
npm error command failed
npm error command C:\Windows\system32\cmd.exe /d /s /c jest apps/api/tests/tenancy.test.js


> web@0.1.0 test
> vitest apps/api/tests/tenancy.test.js


[1m[44m DEV [49m[22m [34mv4.0.10 [39m[90mC:/Users/joel.abraham/Shipping Doc Gen/Shipping-Doc-Gen/apps/web[39m

[31mNo test files found. You can change the file name pattern by pressing "p"
[39m
filter: apps/api/tests/tenancy.test.js
include: **/*.{test,spec}.?(c|m)[jt]s?(x)
exclude:  **/node_modules/**, **/dist/**, **/e2e/**, **/tests-e2e/**

(node:2812) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///C:/Users/joel.abraham/Shipping%20Doc%20Gen/Shipping-Doc-Gen/apps/web/postcss.config.js?t=1765406459451 is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to C:\Users\joel.abraham\Shipping Doc Gen\Shipping-Doc-Gen\apps\web\package.json.
(Use `node --trace-warnings ...` to show where the warning was created)
